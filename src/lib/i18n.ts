export type Locale = "pt-BR" | "en";
export const LOCALES: Locale[] = ["pt-BR", "en"];
export const DEFAULT_LOCALE: Locale = "pt-BR";

export function pickLocale(input?: string | null): Locale {
  if (!input) return DEFAULT_LOCALE;
  const x = input.toLowerCase();
  if (x.startsWith("pt") || /pt(-|_)?br/.test(x)) return "pt-BR";
  if (x.startsWith("en") || /en(-|_)?(us|gb|au|ca)?/.test(x)) return "en";
  return DEFAULT_LOCALE;
}

export type Dict = Record<string, string>;

const ptBR: Dict = {
  "brand.name": "BiblioRadar",
  "nav.search": "Buscar",
  "nav.addProvider": "+ Provedor",
  "home.tagline": "Busque em Gutenberg, Internet Archive, Open Library e nos provedores que você adicionar (OPDS/Scraper).",
  "search.placeholder": "Ex.: Dom Casmurro, Lima Barreto… (atalho: /)",
  "search.onlyPdf": "Somente com PDF",
  "search.prioritizeExternal": "Priorizar sites externos",
  "results.none": "Nenhum resultado {pdf}para “{q}”.",
  "results.loadMore": "Carregar mais",
  "external.title": "Sites externos",
  "cookies.title": "Cookies só para suas preferências.",
  "cookies.desc": "Guardamos tema, filtro “Somente PDF” e seus sites/provedores no seu navegador. Não usamos analytics.",
  "cookies.later": "Agora não",
  "cookies.ok": "Ok, pode usar cookies",
  "book.download": "Baixar PDF",
  "book.server": "Via servidor",
  "book.read": "Ler online",
  "book.untitled": "Sem título",
  "book.unknownAuthor": "Autor desconhecido",
  "book.notVerified": "Não verificado (alguns hosts bloqueiam HEAD)",
  "book.direct": "Baixar diretamente da fonte",
  "book.serverTooltip": "Baixar via servidor (evita CORS)",
  "common.remove": "Remover",
  "ext.preview": "preview:",
  "ext.open": "Abrir com “{q}”",
  "ext.copy": "Copiar link",
  "ext.none": "Nenhum site cadastrado.",
  "ext.openIn": "Abrir em {name}",
  "ext.quick.title": "Sites externos",
  "ext.quick.none": "Nenhum site externo.",
  "ext.quick.add": "Adicionar",
  "ext.quick.manage": "Gerenciar sites",
  "ext.quick.typeToEnable": "Digite uma busca para habilitar os botões.",
  "ext.err.nameUrl": "Informe um nome e uma URL começando com http(s). Você pode usar {query}, {plus} ou {raw}.",
  "ext.title": "Abrir sites externos (sem automação)",
  "ext.subtitle": "Cadastre modelos com {query} (URL-encoded), {plus} (espaços com +) ou {raw}. Se não usar placeholder, adicionamos automaticamente ?q=.",
  "ext.namePh": "Nome do site (ex.: Anna’s Archive)",
  "ext.urlPh": "https://site.ex/search?q={query}  (ou {plus}/{raw})",
  "ext.add": "Adicionar site",
  "pm.title": "Provedores adicionais",
  "pm.tab.opds": "OPDS",
  "pm.tab.scraper": "Scraper (CSS)",
  "pm.opds.placeholder": "https://minha-biblioteca/opds",
  "pm.opds.add": "Adicionar OPDS",
  "pm.opds.note": "Feeds OPDS entram na busca automaticamente.",
  "pm.err.url": "Informe uma URL válida (http/https).",
  "pm.scr.name": "Nome do scraper",
  "pm.scr.url": "URL de busca do site (com {query}/{plus}/{raw})",
  "pm.scr.sel.root": "Seletor CSS do item raiz (ex.: .result)",
  "pm.scr.sel.title": "Seletor CSS do título",
  "pm.scr.sel.href": "Seletor CSS do link (href)",
  "pm.scr.sel.cover": "Seletor CSS da capa (src)",
  "pm.scr.sel.author": "Seletor CSS do autor",
  "pm.scr.sel.year": "Seletor CSS do ano",
  "pm.scr.add": "Adicionar scraper",
  "pm.err.nameUrl": "Informe nome e uma URL com http(s).",
  "pm.err.selectors": "Defina pelo menos os seletores de item e título.",
  "side.title": "BiblioRadar",
  "side.desc": "Buscador cartonado de livros/PDFs em fontes públicas: Project Gutenberg, Internet Archive, Open Library e feeds OPDS/Scraper que você adicionar.",
  "side.p1": "Busca dinâmica com cancelamento e timeouts.",
  "side.p2": "Botões para Baixar PDF direto ou “via servidor”.",
  "side.p3": "Provedores extras: OPDS e Scraper (CSS).",
  "side.p4": "“Sites externos” sempre à mão (abre em nova aba).",
  "side.p5": "Sem banco de dados. Preferências ficam no navegador.",
  "side.privacyTitle": "Privacidade & Cookies",
  "side.privacyDesc": "Usamos cookies essenciais para lembrar tema, filtro “Somente PDF” e suas listas de sites externos e provedores. Sem analytics. Você pode limpar a qualquer momento nas configurações do navegador.",
  "side.extTitle": "Sites externos",
  "side.extTip": "Digite uma busca para habilitar os botões.",
  "side.manage": "Gerenciar sites",
  "home.title": "PDF Books Finder",
  "search.aria": "Consulta",
  "results.searching": "Buscando…",
  "results.count": "{n} resultados",
  "footer.disclaimer": "A aplicação exibe/baixa apenas o que as fontes disponibilizam publicamente.",
};

const en: Dict = {
  "brand.name": "BiblioRadar",
  "nav.search": "Search",
  "nav.addProvider": "+ Provider",
  "home.tagline": "Search across Gutenberg, Internet Archive, Open Library, and any OPDS/Scraper providers you add.",
  "search.placeholder": "e.g., Dom Casmurro, Lima Barreto… (shortcut: /)",
  "search.onlyPdf": "PDF only",
  "search.prioritizeExternal": "Prioritize external sites",
  "results.none": "No results {pdf}for “{q}”.",
  "results.loadMore": "Load more",
  "external.title": "External sites",
  "cookies.title": "Cookies for your preferences only.",
  "cookies.desc": "We store theme, “PDF only”, and your sites/providers in your browser. No analytics.",
  "cookies.later": "Not now",
  "cookies.ok": "OK, enable cookies",
  "book.download": "Download PDF",
  "book.server": "Via server",
  "book.read": "Read online",
  "book.untitled": "Untitled",
  "book.unknownAuthor": "Unknown author",
  "book.notVerified": "Not verified (some hosts block HEAD)",
  "book.direct": "Download directly from source",
  "book.serverTooltip": "Download via server (bypasses CORS)",
  "common.remove": "Remove",
  "ext.preview": "preview:",
  "ext.open": "Open with “{q}”",
  "ext.copy": "Copy link",
  "ext.none": "No site added yet.",
  "ext.openIn": "Open in {name}",
  "ext.quick.title": "External sites",
  "ext.quick.none": "No external site.",
  "ext.quick.add": "Add",
  "ext.quick.manage": "Manage sites",
  "ext.quick.typeToEnable": "Type a query to enable buttons.",
  "ext.err.nameUrl": "Provide a name and an http(s) URL. You can use {query}, {plus} or {raw}.",
  "ext.title": "Open external sites (manual)",
  "ext.subtitle": "Register URL templates with {query} (URL-encoded), {plus} (spaces as +) or {raw}. If no placeholder, we append ?q= automatically.",
  "ext.namePh": "Site name (e.g., Anna’s Archive)",
  "ext.urlPh": "https://site.ex/search?q={query}  (or {plus}/{raw})",
  "ext.add": "Add site",
  "pm.title": "Additional providers",
  "pm.tab.opds": "OPDS",
  "pm.tab.scraper": "Scraper (CSS)",
  "pm.opds.placeholder": "https://my-library/opds",
  "pm.opds.add": "Add OPDS",
  "pm.opds.note": "OPDS feeds are searched automatically.",
  "pm.err.url": "Enter a valid http/https URL.",
  "pm.scr.name": "Scraper name",
  "pm.scr.url": "Site search URL (with {query}/{plus}/{raw})",
  "pm.scr.sel.root": "Item root selector (e.g., .result)",
  "pm.scr.sel.title": "Title selector",
  "pm.scr.sel.href": "Link selector (href)",
  "pm.scr.sel.cover": "Cover selector (src)",
  "pm.scr.sel.author": "Author selector",
  "pm.scr.sel.year": "Year selector",
  "pm.scr.add": "Add scraper",
  "pm.err.nameUrl": "Provide a name and an http(s) URL.",
  "pm.err.selectors": "Set at least item and title selectors.",
  "side.title": "BiblioRadar",
  "side.desc": "Card-styled search for books/PDFs on public sources: Project Gutenberg, Internet Archive, Open Library, and OPDS/Scraper feeds you add.",
  "side.p1": "Dynamic search with cancellation and timeouts.",
  "side.p2": "Buttons to Download PDF directly or “via server”.",
  "side.p3": "Extra providers: OPDS and CSS Scraper.",
  "side.p4": "“External sites” always at hand (opens in new tab).",
  "side.p5": "No database. Preferences stay in your browser.",
  "side.privacyTitle": "Privacy & Cookies",
  "side.privacyDesc": "We use essential cookies to remember theme, “PDF only” and your external sites/providers. No analytics. Clear anytime in your browser settings.",
  "side.extTitle": "External sites",
  "side.extTip": "Type a query to enable the buttons.",
  "side.manage": "Manage sites",
  "home.title": "PDF Books Finder",
  "search.aria": "Query",
  "results.searching": "Searching…",
  "results.count": "{n} results",
  "footer.disclaimer": "The app only shows/downloads what sources publicly provide.",
};

export const DICTS: Record<Locale, Dict> = { "pt-BR": ptBR, en };

export function format(str: string, params?: Record<string, unknown>) {
  if (!params) return str;
  return str.replace(/\{(\w+)\}/g, (_: string, k: string) =>
    String((params as Record<string, unknown>)[k] ?? "")
  );
}
